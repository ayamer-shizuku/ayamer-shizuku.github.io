<!DOCTYPE html>
<html lang="zh-CN">
<head>
   <meta charset="UTF-8">
   <title>JellyTime è®ºå›</title>
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
           font-family: "Microsoft Yahei", sans-serif;
       }
       body {
           max-width: 800px;
           margin: 0 auto;
           padding: 20px;
           background-color: #f7f8fa;
           padding-bottom: 80px; /* ä¸ºåº•éƒ¨å¯¼èˆªæ é¢„ç•™ç©ºé—´ */
       }
       header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin-bottom: 30px;
           padding-bottom: 15px;
           border-bottom: 1px solid #eee;
       }
       h1 a {
           color: #4299e1;
           text-decoration: none;
       }
       .user-info {
           display: flex;
           align-items: center;
           gap: 10px;
       }
       .user-avatar {
           width: 40px;
           height: 40px;
           border-radius: 50%;
           object-fit: cover;
           border: 2px solid #4299e1;
       }
       .btn {
           padding: 8px 16px;
           background-color: #4299e1;
           color: #fff;
           border: none;
           border-radius: 6px;
           cursor: pointer;
           text-decoration: none;
           font-size: 14px;
       }
       .btn-outline {
           background-color: transparent;
           color: #4299e1;
           border: 1px solid #4299e1;
       }
       .post-btn {
           margin-bottom: 20px;
           display: inline-block;
       }
       .post-item {
           background: #fff;
           padding: 20px;
           border-radius: 8px;
           margin-bottom: 15px;
           box-shadow: 0 2px 8px rgba(0,0,0,0.05);
           transition: box-shadow 0.3s;
       }
       .post-item:hover {
           box-shadow: 0 4px 12px rgba(0,0,0,0.1);
       }
       .post-item h3 {
           margin-bottom: 10px;
       }
       .post-item a {
           color: #333;
           text-decoration: none;
       }
       .post-item a:hover {
           color: #4299e1;
       }
       .post-meta {
           font-size: 12px;
           color: #666;
           margin-top: 10px;
           display: flex;
           gap: 15px;
       }
       .modal {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.5);
           align-items: center;
           justify-content: center;
           z-index: 999;
       }
       .modal-content {
           background: #fff;
           padding: 30px;
           border-radius: 10px;
           width: 90%;
           max-width: 500px;
       }
       .modal-content h2 {
           margin-bottom: 20px;
           color: #333;
           font-size: 18px;
       }
       .form-group {
           margin-bottom: 15px;
       }
       .form-group label {
           display: block;
           margin-bottom: 6px;
           color: #333;
           font-size: 14px;
       }
       .form-group input, .form-group textarea {
           width: 100%;
           padding: 10px;
           border: 1px solid #ddd;
           border-radius: 6px;
           font-size: 14px;
       }
       .form-group textarea {
           min-height: 120px;
           resize: vertical;
       }
       .modal-footer {
           display: flex;
           gap: 10px;
           justify-content: flex-end;
           margin-top: 20px;
       }
       .empty-tip {
           text-align: center;
           color: #999;
           padding: 40px 0;
           background: #fff;
           border-radius: 8px;
       }
       .admin-tag {
           color: #ff4444;
           font-size: 12px;
           margin-left: 5px;
           font-weight: bold;
       }
       /* æ‚¬æµ®é‚®ä»¶å›¾æ ‡æ ·å¼ */
       .email-float-btn {
           position: fixed;
           right: 20px;
           bottom: 80px; /* é¿å¼€åº•éƒ¨å¯¼èˆªæ  */
           width: 60px;
           height: 60px;
           background-color: #4299e1;
           border-radius: 50%;
           display: flex;
           align-items: center;
           justify-content: center;
           color: #fff;
           font-size: 24px;
           cursor: pointer;
           box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
           z-index: 1000;
           transition: background-color 0.3s;
       }
       .email-float-btn:hover {
           background-color: #3182ce;
       }
       /* å»ºè®®è¡¨å•å¼¹çª—æ ·å¼ */
       .email-modal {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.5);
           align-items: center;
           justify-content: center;
           z-index: 1001;
       }
       .email-modal-content {
           background: #fff;
           padding: 30px;
           border-radius: 10px;
           width: 90%;
           max-width: 400px;
       }
       .email-modal-content h3 {
           color: #333;
           margin-bottom: 20px;
           text-align: center;
       }
       .email-modal-content .form-group {
           margin-bottom: 15px;
       }
       .email-modal-content input,
       .email-modal-content textarea {
           width: 100%;
           padding: 10px;
           border: 1px solid #ddd;
           border-radius: 6px;
           font-size: 14px;
       }
       .email-modal-content textarea {
           min-height: 120px;
           resize: vertical;
       }
       .email-modal-footer {
           display: flex;
           gap: 10px;
           justify-content: flex-end;
           margin-top: 20px;
       }
       .email-modal-footer button {
           padding: 8px 16px;
           border: none;
           border-radius: 6px;
           cursor: pointer;
       }
       .btn-primary {
           background-color: #4299e1;
           color: #fff;
       }
       .btn-secondary {
           background-color: #ddd;
           color: #333;
       }
       /* åº•éƒ¨å¯¼èˆªæ æ ·å¼ */
       .bottom-nav {
           position: fixed;
           bottom: 0;
           left: 0;
           width: 100%;
           height: 60px;
           background-color: #fff;
           border-top: 1px solid #eee;
           display: flex;
           justify-content: space-around;
           align-items: center;
           z-index: 998;
       }
       .nav-item {
           display: flex;
           flex-direction: column;
           align-items: center;
           text-decoration: none;
           color: #666;
           font-size: 12px;
       }
       .nav-icon {
           font-size: 24px;
           margin-bottom: 4px;
       }
       .nav-item.active {
           color: #4299e1;
       }
       /* å›¾ç‰‡/è§†é¢‘é¢„è§ˆæ ·å¼ */
       #imagePreview img {
           width: 80px;
           height: 80px;
           object-fit: cover;
           border-radius: 4px;
       }
       #videoPreview video {
           max-width: 100%;
           max-height: 200px;
           border-radius: 4px;
       }
       .post-images {
           margin-top: 10px;
           display: flex;
           flex-wrap: wrap;
           gap: 8px;
       }
       .post-images img {
           width: 80px;
           height: 80px;
           object-fit: cover;
           border-radius: 4px;
       }
       .post-video {
           margin-top: 10px;
       }
       .post-video video {
           max-width: 100%;
           max-height: 200px;
           border-radius: 4px;
       }
       /* --- æ‰‹æœºé€‚é…æ ·å¼ --- */
       .is-mobile body {
           max-width: 100%;
           padding: 10px;
       }
       .is-mobile .post-item {
           padding: 15px;
       }
       .is-mobile .btn {
           padding: 12px 20px;
           font-size: 16px;
       }
       .is-mobile .form-group input,
       .is-mobile .form-group textarea {
           padding: 12px;
           font-size: 16px;
       }
       .is-mobile .email-float-btn {
           width: 50px;
           height: 50px;
           font-size: 20px;
           bottom: 70px;
       }
       .is-mobile .modal-content,
       .is-mobile .email-modal-content {
           width: 95%;
           padding: 20px;
       }
   </style>
</head>
<body>
   <header>
       <h1><a href="index.html">JellyTime è®ºå›</a></h1>
       <div class="user-info" id="user-info">
           <span>æœªç™»å½•</span>
           <a href="login.html" class="btn">ç™»å½•</a>
           <a href="register.html" class="btn btn-outline">æ³¨å†Œ</a>
       </div>
   </header>

   <a href="javascript:void(0)" class="btn post-btn" id="create-post-btn">å‘å¸ƒæ–°å¸–</a>

   <!-- å¸–å­åˆ—è¡¨ -->
   <div id="post-list"></div>

   <!-- å‘å¸–å¼¹çª— -->
   <div class="modal" id="post-modal">
       <div class="modal-content">
           <h2>å‘å¸ƒæ–°å¸–</h2>
           <div class="form-group">
               <input type="text" id="post-title" placeholder="è¯·è¾“å…¥å¸–å­æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰">
           </div>
           <div class="form-group">
               <textarea id="post-content" placeholder="è¯·è¾“å…¥å¸–å­å†…å®¹ï¼ˆå¿…å¡«ï¼‰"></textarea>
           </div>
           <!-- æ–°å¢ï¼šä¸Šä¼ å›¾ç‰‡ -->
           <div class="form-group">
               <label>ä¸Šä¼ å›¾ç‰‡ï¼ˆæœ€å¤š15å¼ ï¼‰</label>
               <input type="file" id="imageUpload" accept="image/*" multiple>
               <div id="imagePreview" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 8px;"></div>
           </div>
           <!-- æ–°å¢ï¼šä¸Šä¼ è§†é¢‘ -->
           <div class="form-group">
               <label>ä¸Šä¼ è§†é¢‘ï¼ˆå¯é€‰1ä¸ªï¼‰</label>
               <input type="file" id="videoUpload" accept="video/*">
               <div id="videoPreview" style="margin-top: 10px;"></div>
           </div>
           <div class="modal-footer">
               <button class="btn btn-outline" id="cancel-post">å–æ¶ˆ</button>
               <button class="btn" id="submit-post">å‘å¸ƒ</button>
           </div>
       </div>
   </div>

   <!-- æ‚¬æµ®é‚®ä»¶å›¾æ ‡ -->
   <div class="email-float-btn" id="emailBtn">âœ‰ï¸</div>

   <!-- å»ºè®®æäº¤å¼¹çª— -->
   <div class="email-modal" id="emailModal">
       <div class="email-modal-content">
           <h3>ç»™ç«™é•¿æå»ºè®®</h3>
           <div class="form-group">
               <input type="text" id="suggestTitle" placeholder="å»ºè®®æ ‡é¢˜ï¼ˆé€‰å¡«ï¼‰">
           </div>
           <div class="form-group">
               <textarea id="suggestContent" placeholder="è¯·è¾“å…¥ä½ çš„å»ºè®®å†…å®¹ï¼ˆå¿…å¡«ï¼‰"></textarea>
           </div>
           <div class="email-modal-footer">
               <button class="btn-secondary" id="closeModalBtn">å–æ¶ˆ</button>
               <button class="btn-primary" id="sendSuggestBtn">å‘é€å»ºè®®</button>
           </div>
       </div>
   </div>

   <!-- åº•éƒ¨å¯¼èˆªæ  -->
   <nav class="bottom-nav">
       <a href="index.html" class="nav-item active">
           <span class="nav-icon">ğŸ </span>
           <span class="nav-text">é¦–é¡µ</span>
       </a>
       <a href="login.html" class="nav-item">
           <span class="nav-icon">ğŸ‘¤</span>
           <span class="nav-text">ç™»å½•</span>
       </a>
       <a href="game.html" class="nav-item">
           <span class="nav-icon">ğŸ®</span>
           <span class="nav-text">æ¸¸æˆ</span>
       </a>
   </nav>

   <script>
       // --- è®¾å¤‡æ£€æµ‹æ’ä»¶ ---
       (function() {
           function detectDevice() {
               const userAgent = navigator.userAgent || navigator.vendor || window.opera;
               const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
               const body = document.body;
               if (isMobile) {
                   body.classList.add('is-mobile');
                   body.classList.remove('is-desktop');
               } else {
                   body.classList.add('is-desktop');
                   body.classList.remove('is-mobile');
               }
           }
           window.addEventListener('DOMContentLoaded', detectDevice);
           window.addEventListener('resize', detectDevice);
       })();

       // å…ƒç´ è·å–
       const userInfo = document.getElementById('user-info');
       const createPostBtn = document.getElementById('create-post-btn');
       const postModal = document.getElementById('post-modal');
       const cancelPostBtn = document.getElementById('cancel-post');
       const submitPostBtn = document.getElementById('submit-post');
       const postList = document.getElementById('post-list');
       const postTitleInput = document.getElementById('post-title');
       const postContentInput = document.getElementById('post-content');
       const imageUpload = document.getElementById('imageUpload');
       const imagePreview = document.getElementById('imagePreview');
       const videoUpload = document.getElementById('videoUpload');
       const videoPreview = document.getElementById('videoPreview');

       // æœ¬åœ°å­˜å‚¨æ•°æ®
       const currentUser = JSON.parse(localStorage.getItem('currentUser'));
       let posts = JSON.parse(localStorage.getItem('forumPosts')) || [
           { id: '1', title: 'æ¬¢è¿æ¥åˆ° JellyTime è®ºå›', content: 'è¿™æ˜¯è®ºå›çš„ç¬¬ä¸€æ¡æµ‹è¯•å¸–å­ï¼Œå¤§å®¶å¯ä»¥åœ¨è¿™é‡Œç•…æ‰€æ¬²è¨€ï¼ğŸ‰', author: 'ç®¡ç†å‘˜', time: '2026-01-01 10:00', images: [], video: '' },
           { id: '2', title: 'è®ºå›ä½¿ç”¨æŒ‡å—', content: '1. æ³¨å†Œè´¦æˆ·åå¯å‘å¸ƒæ–°å¸–ï¼›2. æ”¯æŒä¸Šä¼ ä¸ªäººå¤´åƒï¼›3. è¯„è®ºå’Œç‚¹èµæ•°æ®ä¿å­˜åœ¨æœ¬åœ°', author: 'ç®¡ç†å‘˜', time: '2026-01-02 15:30', images: [], video: '' }
       ];

       // æ›´æ–°ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼ˆå¸¦ç«™é•¿æ ‡è¯†ï¼‰
       function updateUserStatus() {
           if (currentUser) {
               const isAdmin = currentUser.email === 'jellytime_official@163.com';
               const usernameDisplay = isAdmin
                   ? `${currentUser.username} <span class="admin-tag">æœ¬ç«™ç«™é•¿</span>`
                   : currentUser.username;

               userInfo.innerHTML = `
                   <img src="${currentUser.avatar || 'https://via.placeholder.com/40'}" class="user-avatar" alt="ç”¨æˆ·å¤´åƒ">
                   <span>${usernameDisplay}</span>
                   <button class="btn btn-outline" id="logout-btn">é€€å‡º</button>
               `;
               document.getElementById('logout-btn').addEventListener('click', () => {
                   localStorage.removeItem('currentUser');
                   alert('é€€å‡ºç™»å½•æˆåŠŸï¼');
                   window.location.reload();
               });
           }
       }

       // æ¸²æŸ“å¸–å­åˆ—è¡¨
       function renderPosts() {
           if (posts.length === 0) {
               postList.innerHTML = '<div class="empty-tip">æš‚æ— å¸–å­ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡å§ï¼</div>';
               return;
           }
           postList.innerHTML = '';
           posts.forEach(post => {
               const postItem = document.createElement('div');
               postItem.className = 'post-item';
               postItem.innerHTML = `
                   <h3><a href="post.html?id=${post.id}">${post.title}</a></h3>
                   <p>${post.content.length > 60 ? post.content.slice(0, 60) + '...' : post.content}</p>
                   ${post.images && post.images.length > 0 ? `
                       <div class="post-images">
                           ${post.images.map(img => `<img src="${img}">`).join('')}
                       </div>
                   ` : ''}
                   ${post.video ? `
                       <div class="post-video">
                           <video src="${post.video}" controls></video>
                       </div>
                   ` : ''}
                   <div class="post-meta">
                       <span>ä½œè€…ï¼š${post.author}</span>
                       <span>æ—¶é—´ï¼š${post.time}</span>
                   </div>
               `;
               postList.appendChild(postItem);
           });
       }

       // å‘å¸–å¼¹çª—æ§åˆ¶
       createPostBtn.addEventListener('click', () => {
           if (!currentUser) {
               alert('è¯·å…ˆç™»å½•å†å‘å¸ƒå¸–å­ï¼');
               window.location.href = 'login.html';
               return;
           }
           postModal.style.display = 'flex';
       });
       cancelPostBtn.addEventListener('click', () => {
           postModal.style.display = 'none';
           postTitleInput.value = '';
           postContentInput.value = '';
           imageUpload.value = '';
           imagePreview.innerHTML = '';
           videoUpload.value = '';
           videoPreview.innerHTML = '';
       });

       // å›¾ç‰‡ä¸Šä¼ é¢„è§ˆ + é™åˆ¶æœ€å¤š15å¼ 
       imageUpload.addEventListener('change', () => {
           const files = imageUpload.files;
           if (files.length > 15) {
               alert('æœ€å¤šåªèƒ½ä¸Šä¼ 15å¼ å›¾ç‰‡');
               imageUpload.value = '';
               imagePreview.innerHTML = '';
               return;
           }

           imagePreview.innerHTML = '';
           for (let i = 0; i < files.length; i++) {
               const file = files[i];
               const reader = new FileReader();
               reader.onload = (e) => {
                   const img = document.createElement('img');
                   img.src = e.target.result;
                   imagePreview.appendChild(img);
               };
               reader.readAsDataURL(file);
           }
       });

       // è§†é¢‘ä¸Šä¼ é¢„è§ˆ + é™åˆ¶1ä¸ª
       videoUpload.addEventListener('change', () => {
           const file = videoUpload.files[0];
           if (!file) return;

           videoPreview.innerHTML = '';
           const reader = new FileReader();
           reader.onload = (e) => {
               const video = document.createElement('video');
               video.src = e.target.result;
               video.controls = true;
               videoPreview.appendChild(video);
           };
           reader.readAsDataURL(file);
       });

       // æäº¤æ–°å¸–
       submitPostBtn.addEventListener('click', () => {
           const title = postTitleInput.value.trim();
           const content = postContentInput.value.trim();
           if (!title || !content) {
               alert('æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
               return;
           }

           // æ”¶é›†å›¾ç‰‡
           const imageFiles = imageUpload.files;
           const imageUrls = [];
           for (let i = 0; i < imageFiles.length; i++) {
               const file = imageFiles[i];
               const reader = new FileReader();
               reader.onload = (e) => {
                   imageUrls.push(e.target.result);
               };
               reader.readAsDataURL(file);
           }

           // æ”¶é›†è§†é¢‘
           const videoFile = videoUpload.files[0];
           let videoUrl = '';
           if (videoFile) {
               const reader = new FileReader();
               reader.onload = (e) => {
                   videoUrl = e.target.result;
               };
               reader.readAsDataURL(videoFile);
           }

           // åˆ›å»ºæ–°å¸–å­
           const newPost = {
               id: Date.now().toString(),
               title,
               content,
               author: currentUser.username,
               time: new Date().toLocaleString(),
               images: imageUrls,
               video: videoUrl
           };
           posts.unshift(newPost);
           localStorage.setItem('forumPosts', JSON.stringify(posts));
           renderPosts();
           cancelPostBtn.click();
           alert('å¸–å­å‘å¸ƒæˆåŠŸï¼');
       });

       // é‚®ä»¶å»ºè®®åŠŸèƒ½
       const emailBtn = document.getElementById('emailBtn');
       const emailModal = document.getElementById('emailModal');
       const closeModalBtn = document.getElementById('closeModalBtn');
       const sendSuggestBtn = document.getElementById('sendSuggestBtn');
       const suggestTitle = document.getElementById('suggestTitle');
       const suggestContent = document.getElementById('suggestContent');

       emailBtn.addEventListener('click', () => {
           e

