<!DOCTYPE html>
<html lang="zh-CN">
<head>
   <meta charset="UTF-8">
   <title>å¸–å­è¯¦æƒ… - JellyTime è®ºå›</title>
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
           font-family: "Microsoft Yahei", sans-serif;
       }
       body {
           max-width: 800px;
           margin: 0 auto;
           padding: 20px;
           background-color: #f7f8fa;
           padding-bottom: 80px; /* ä¸ºåº•éƒ¨å¯¼èˆªæ é¢„ç•™ç©ºé—´ */
       }
       header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin-bottom: 30px;
           padding-bottom: 15px;
           border-bottom: 1px solid #eee;
       }
       h1 a {
           color: #4299e1;
           text-decoration: none;
       }
       .post-detail {
           background: #fff;
           padding: 30px;
           border-radius: 10px;
           box-shadow: 0 2px 10px rgba(0,0,0,0.05);
       }
       .post-detail h2 {
           color: #333;
           margin-bottom: 20px;
       }
       .post-meta {
           font-size: 14px;
           color: #666;
           margin-bottom: 20px;
           display: flex;
           gap: 20px;
       }
       .post-content {
           font-size: 16px;
           line-height: 1.6;
           color: #333;
           margin-bottom: 20px;
       }
       /* å¸–å­å›¾ç‰‡æ ·å¼ */
       .post-images {
           margin-top: 20px;
           display: flex;
           flex-wrap: wrap;
           gap: 10px;
       }
       .post-images img {
           width: 100px;
           height: 100px;
           object-fit: cover;
           border-radius: 6px;
           cursor: pointer;
           transition: transform 0.3s;
       }
       .post-images img:hover {
           transform: scale(1.05);
       }
       /* å¸–å­è§†é¢‘æ ·å¼ */
       .post-video {
           margin-top: 20px;
       }
       .post-video video {
           max-width: 100%;
           max-height: 400px;
           border-radius: 6px;
       }
       /* è¯„è®ºåŒºæ ·å¼ */
       .comment-section {
           margin-top: 40px;
       }
       .comment-section h3 {
           color: #333;
           margin-bottom: 20px;
       }
       .comment-form {
           margin-bottom: 30px;
       }
       .form-group {
           margin-bottom: 15px;
       }
       .form-group textarea {
           width: 100%;
           padding: 10px;
           border: 1px solid #ddd;
           border-radius: 6px;
           font-size: 14px;
           min-height: 100px;
           resize: vertical;
       }
       .btn {
           padding: 8px 16px;
           background-color: #4299e1;
           color: #fff;
           border: none;
           border-radius: 6px;
           cursor: pointer;
           font-size: 14px;
       }
       .btn-outline {
           background-color: transparent;
           color: #4299e1;
           border: 1px solid #4299e1;
       }
       .comment-list {
           margin-top: 20px;
       }
       .comment-item {
           background: #fff;
           padding: 15px;
           border-radius: 8px;
           margin-bottom: 15px;
           box-shadow: 0 2px 8px rgba(0,0,0,0.05);
       }
       .comment-meta {
           font-size: 12px;
           color: #666;
           margin-bottom: 10px;
           display: flex;
           gap: 15px;
       }
       .comment-content {
           font-size: 14px;
           line-height: 1.5;
           color: #333;
       }
       .empty-comment {
           text-align: center;
           color: #999;
           padding: 30px 0;
           background: #fff;
           border-radius: 8px;
       }
       /* åº•éƒ¨å¯¼èˆªæ æ ·å¼ */
       .bottom-nav {
           position: fixed;
           bottom: 0;
           left: 0;
           width: 100%;
           height: 60px;
           background-color: #fff;
           border-top: 1px solid #eee;
           display: flex;
           justify-content: space-around;
           align-items: center;
           z-index: 998;
       }
       .nav-item {
           display: flex;
           flex-direction: column;
           align-items: center;
           text-decoration: none;
           color: #666;
           font-size: 12px;
       }
       .nav-icon {
           font-size: 24px;
           margin-bottom: 4px;
       }
       .nav-item.active {
           color: #4299e1;
       }
       /* --- æ‰‹æœºé€‚é…æ ·å¼ --- */
       .is-mobile body {
           max-width: 100%;
           padding: 10px;
       }
       .is-mobile .post-detail {
           padding: 20px;
       }
       .is-mobile .post-images img {
           width: 80px;
           height: 80px;
       }
       .is-mobile .btn {
           padding: 12px 20px;
           font-size: 16px;
       }
       .is-mobile .form-group textarea {
           padding: 12px;
           font-size: 16px;
       }
   </style>
</head>
<body>
   <header>
       <h1><a href="index.html">JellyTime è®ºå›</a></h1>
   </header>

   <div class="post-detail" id="post-detail">
       <!-- å¸–å­å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
   </div>

   <div class="comment-section">
       <h3>è¯„è®ºåŒº</h3>
       <div class="comment-form">
           <div class="form-group">
               <textarea id="comment-content" placeholder="è¯·è¾“å…¥è¯„è®ºå†…å®¹ï¼ˆå¿…å¡«ï¼‰"></textarea>
           </div>
           <button class="btn" id="submit-comment">å‘è¡¨è¯„è®º</button>
       </div>
       <div class="comment-list" id="comment-list">
           <!-- è¯„è®ºåˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
       </div>
   </div>

   <!-- åº•éƒ¨å¯¼èˆªæ  -->
   <nav class="bottom-nav">
       <a href="index.html" class="nav-item">
           <span class="nav-icon">ğŸ </span>
           <span class="nav-text">é¦–é¡µ</span>
       </a>
       <a href="login.html" class="nav-item">
           <span class="nav-icon">ğŸ‘¤</span>
           <span class="nav-text">ç™»å½•</span>
       </a>
       <a href="game.html" class="nav-item">
           <span class="nav-icon">ğŸ®</span>
           <span class="nav-text">æ¸¸æˆ</span>
       </a>
   </nav>

   <script>
       // --- è®¾å¤‡æ£€æµ‹æ’ä»¶ ---
       (function() {
           function detectDevice() {
               const userAgent = navigator.userAgent || navigator.vendor || window.opera;
               const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
               const body = document.body;
               if (isMobile) {
                   body.classList.add('is-mobile');
                   body.classList.remove('is-desktop');
               } else {
                   body.classList.add('is-desktop');
                   body.classList.remove('is-mobile');
               }
           }
           window.addEventListener('DOMContentLoaded', detectDevice);
           window.addEventListener('resize', detectDevice);
       })();

       // å…ƒç´ è·å–
       const postDetail = document.getElementById('post-detail');
       const commentList = document.getElementById('comment-list');
       const commentContent = document.getElementById('comment-content');
       const submitCommentBtn = document.getElementById('submit-comment');

       // ä»URLè·å–å¸–å­ID
       const urlParams = new URLSearchParams(window.location.search);
       const postId = urlParams.get('id');

       // æœ¬åœ°å­˜å‚¨æ•°æ®
       const currentUser = JSON.parse(localStorage.getItem('currentUser'));
       let posts = JSON.parse(localStorage.getItem('forumPosts')) || [];
       let comments = JSON.parse(localStorage.getItem('postComments')) || {};

       // æ‰¾åˆ°å½“å‰å¸–å­
       const post = posts.find(p => p.id === postId);

       // æ¸²æŸ“å¸–å­è¯¦æƒ…
       function renderPostDetail() {
           if (!post) {
               postDetail.innerHTML = '<h2>å¸–å­ä¸å­˜åœ¨</h2>';
               return;
           }

           postDetail.innerHTML = `
               <h2>${post.title}</h2>
               <div class="post-meta">
                   <span>ä½œè€…ï¼š${post.author}</span>
                   <span>æ—¶é—´ï¼š${post.time}</span>
               </div>
               <div class="post-content">${post.content}</div>
               ${post.images && post.images.length > 0 ? `
                   <div class="post-images">
                       ${post.images.map(img => `<img src="${img}" alt="å¸–å­å›¾ç‰‡">`).join('')}
                   </div>
               ` : ''}
               ${post.video ? `
                   <div class="post-video">
                       <video src="${post.video}" controls></video>
                   </div>
               ` : ''}
           `;
       }

       // æ¸²æŸ“è¯„è®ºåˆ—è¡¨
       function renderComments() {
           const postComments = comments[postId] || [];
           if (postComments.length === 0) {
               commentList.innerHTML = '<div class="empty-comment">æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï¼</div>';
               return;
           }

           commentList.innerHTML = '';
           postComments.forEach(comment => {
               const commentItem = document.createElement('div');
               commentItem.className = 'comment-item';
               commentItem.innerHTML = `
                   <div class="comment-meta">
                       <span>ä½œè€…ï¼š${comment.author}</span>
                       <span>æ—¶é—´ï¼š${comment.time}</span>
                   </div>
                   <div class="comment-content">${comment.content}</div>
               `;
               commentList.appendChild(commentItem);
           });
       }

       // å‘è¡¨è¯„è®º
       submitCommentBtn.addEventListener('click', () => {
           if (!currentUser) {
               alert('è¯·å…ˆç™»å½•å†å‘è¡¨è¯„è®ºï¼');
               window.location.href = 'login.html';
               return;
           }

           const content = commentContent.value.trim();
           if (!content) {
               alert('è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
               return;
           }

           const newComment = {
               id: Date.now().toString(),
               content,
               author: currentUser.username,
               time: new Date().toLocaleString()
           };

           // åˆå§‹åŒ–è¯„è®ºæ•°ç»„ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
           if (!comments[postId]) {
               comments[postId] = [];
           }

           comments[postId].unshift(newComment);
           localStorage.setItem('postComments', JSON.stringify(comments));
           renderComments();
           commentContent.value = '';
           alert('è¯„è®ºå‘è¡¨æˆåŠŸï¼');
       });

       // åˆå§‹åŒ–
       renderPostDetail();
       renderComments();
   </script>
</body>
</html>


