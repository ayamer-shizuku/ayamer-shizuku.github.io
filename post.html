<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¸–å­è¯¦æƒ… - JellyTime è®ºå›</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", sans-serif;
        }
        body {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f7f8fa;
        }
        header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        header h1 a {
            color: #4299e1;
            text-decoration: none;
        }
        .current-user {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .current-user img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid #ddd;
        }
        .current-user span {
            color: #666;
        }
        .post-detail {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }
        .post-detail h2 {
            color: #333;
            margin-bottom: 15px;
        }
        .post-detail .meta {
            color: #999;
            font-size: 12px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .post-detail p {
            line-height: 1.6;
            color: #333;
        }
        .like-section {
            margin-bottom: 30px;
        }
        #like-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #4299e1;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        #like-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .comment-section {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .comment-section h3 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .comment-item {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .comment-item:last-child {
            border-bottom: none;
        }
        .comment-author {
            font-weight: bold;
            color: #4299e1;
            margin-bottom: 5px;
        }
        .comment-time {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        .comment-input {
            margin-top: 20px;
        }
        .comment-input input,
        .comment-input textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .comment-input textarea {
            min-height: 80px;
            resize: vertical;
        }
        #submit-comment {
            padding: 8px 16px;
            background-color: #4299e1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .empty-tip {
            color: #999;
            text-align: center;
            padding: 20px 0;
        }
        footer {
            text-align: center;
            margin: 30px 0;
            color: #666;
            font-size: 14px;
        }
        .admin-tag {
            color: #ff4444;
            font-size: 12px;
            margin-left: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <h1><a href=" ">JellyTime è®ºå›</a ></h1>
    </header>

    <!-- å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ -->
    <div class="current-user" id="current-user"></div>

    <main>
        <!-- å¸–å­è¯¦æƒ… -->
        <div class="post-detail">
            <h2 id="post-title">æ¬¢è¿å¸–</h2>
            <div class="meta" id="post-meta">ä½œè€…ï¼šç®¡ç†å‘˜ | æ—¶é—´ï¼š2026-01-01</div>
            <p id="post-content">è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€æ¡å¸–å­ï¼ğŸ‰</p >
        </div>

        <!-- ç‚¹èµåŠŸèƒ½ -->
        <div class="like-section">
            <button id="like-btn">ğŸ‘ ç‚¹èµ (0)</button>
        </div>

        <!-- è¯„è®ºåŠŸèƒ½ -->
        <div class="comment-section">
            <h3>è¯„è®ºåŒº</h3>
            <div id="comments-list"></div>

            <div class="comment-input">
                <input type="text" id="nickname" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§°">
                <textarea id="comment-content" placeholder="è¯·è¾“å…¥ä½ çš„è¯„è®ºå†…å®¹"></textarea>
                <button id="submit-comment">æäº¤è¯„è®º</button>
            </div>
        </div>
    </main>

    <footer>
        <p>Â© 2026 JellyTime è®ºå›</p >
    </footer>

    <script>
        // 1. è·å–URLå‚æ•°å’Œç”¨æˆ·ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id') || '1';
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        const posts = JSON.parse(localStorage.getItem('forumPosts')) || [];

        // 2. æ¸²æŸ“å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆå¸¦ç«™é•¿æ ‡è¯†ï¼‰
        function renderUserInfo() {
            const userDiv = document.getElementById('current-user');
            if (currentUser) {
                // æ£€æµ‹æ˜¯å¦æ˜¯ç«™é•¿é‚®ç®±
                const isAdmin = currentUser.email === 'jellytime_official@163.com';
                const usernameDisplay = isAdmin 
                    ? `${currentUser.username} <span class="admin-tag">æœ¬ç«™ç«™é•¿</span>` 
                    : currentUser.username;

                userDiv.innerHTML = `
                    < img src="${currentUser.avatar || 'https://via.placeholder.com/30'}" alt="å¤´åƒ">
                    <span>å½“å‰ç™»å½•ï¼š${usernameDisplay}</span>
                `;
                document.getElementById('nickname').value = currentUser.username;
                document.getElementById('nickname').disabled = true;
            } else {
                userDiv.innerHTML = '<span>æœªç™»å½• | <a href="login.html" style="color:#4299e1;">å»ç™»å½•</a ></span>';
            }
        }

        // 3. åŠ è½½å¯¹åº”å¸–å­å†…å®¹
        function loadPost() {
            const targetPost = posts.find(post => post.id === postId);
            if (targetPost) {
                document.getElementById('post-title').textContent = targetPost.title;
                document.getElementById('post-content').textContent = targetPost.content;
                document.getElementById('post-meta').textContent = `ä½œè€…ï¼š${targetPost.author} | æ—¶é—´ï¼š${targetPost.time}`;
            }
        }

        // 4. ç‚¹èµåŠŸèƒ½
        function initLike() {
            const likeBtn = document.getElementById('like-btn');
            const likeKey = `liked_${postId}`;
            let likeCount = localStorage.getItem(`likeCount_${postId}`) || 0;
            
            likeBtn.textContent = `ğŸ‘ ç‚¹èµ (${likeCount})`;
            if (localStorage.getItem(likeKey)) {
                likeBtn.disabled = true;
            }

            likeBtn.addEventListener('click', () => {
                try {
                    likeCount++;
                    likeBtn.textContent = `ğŸ‘ ç‚¹èµ (${likeCount})`;
                    likeBtn.disabled = true;
                    localStorage.setItem(likeKey, 'true');
                    localStorage.setItem(`likeCount_${postId}`, likeCount);
                    alert('ç‚¹èµæˆåŠŸï¼');
                } catch (err) {
                    alert('ç‚¹èµå¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            });
        }

        // 5. è¯„è®ºåŠŸèƒ½
        function initComment() {
            const commentsList = document.getElementById('comments-list');
            const nicknameInput = document.getElementById('nickname');
            const commentContentInput = document.getElementById('comment-content');
            const submitBtn = document.getElementById('submit-comment');
            const commentsKey = `comments_${postId}`;
            let comments = JSON.parse(localStorage.getItem(commentsKey)) || [];

            // åŠ è½½è¯„è®º
            function loadComments() {
                if (comments.length === 0) {
                    commentsList.innerHTML = '<p class="empty-tip">è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§~</p >';
                    return;
                }
                commentsList.innerHTML = '';
                comments.forEach(comment => {
                    const div = document.createElement('div');
                    div.className = 'comment-item';
                    div.innerHTML = `
                        <div class="comment-author">${comment.nickname}</div>
                        <div>${comment.content}</div>
                        <div class="comment-time">${comment.time}</div>
                    `;
                    commentsList.appendChild(div);
                });
            }

            // æäº¤è¯„è®º
            submitBtn.addEventListener('click', () => {
                const nickname = nicknameInput.value.trim();
                const content = commentContentInput.value.trim();
                if (!nickname || !content) {
                    alert('æ˜µç§°å’Œè¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                    return;
                }
                const newComment = {
                    nickname,
                    content,
                    time: new Date().toLocaleString()
                };
                comments.push(newComment);
                localStorage.setItem(commentsKey, JSON.stringify(comments));
                loadComments();
                commentContentInput.value = '';
                alert('è¯„è®ºæäº¤æˆåŠŸï¼');
            });

            loadComments();
        }

        // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
        renderUserInfo();
        loadPost();
        initLike();
        initComment();
    </script>
</body>
</html>
